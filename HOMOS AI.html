<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HOMOS AI</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body { font-family: 'Noto Sans Arabic', sans-serif; }
.loader {
  width:18px;height:18px;border:3px solid #6366f1;
  border-bottom-color:transparent;border-radius:50%;
  animation:spin 1s linear infinite
}
@keyframes spin { to { transform: rotate(360deg) } }
</style>
</head>

<body class="bg-[#0b1020] text-white h-screen flex flex-col">

<!-- HEADER -->
<header class="p-4 border-b border-white/10 flex justify-between items-center">
  <h1 class="font-bold text-lg">HOMOS AI</h1>
  <span class="text-xs opacity-40">Advanced AI Assistant</span>
</header>

<!-- CHAT -->
<div id="chat" class="flex-1 overflow-y-auto p-4 space-y-6"></div>

<!-- INPUT -->
<div class="p-4 border-t border-white/10">
  <div class="flex gap-2 items-end bg-[#11162a] p-3 rounded-xl">
    
    <input type="file" id="file" hidden accept="image/*" onchange="handleFile(this)">
    <button onclick="document.getElementById('file').click()" class="opacity-60 hover:opacity-100">
      <i data-lucide="image"></i>
    </button>

    <textarea id="prompt" rows="1" placeholder="Ø§Ø³Ø£Ù„ HOMOS AI..."
      class="flex-1 bg-transparent resize-none outline-none"
      oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"></textarea>

    <button onclick="send()" class="bg-indigo-600 p-2 rounded-lg hover:bg-indigo-700">
      <i data-lucide="send"></i>
    </button>
  </div>

  <p class="text-[10px] text-center opacity-30 mt-3">
    HOMOS AI â€¢ Designed & Developed by Mohamed Homos
  </p>
</div>

<script>
/* ================== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ================== */

// ğŸ”´ Ø¶Ø¹ Ù…ÙØªØ§Ø­ API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§
const apiKey = "AIzaSyCAYty5_UQ32usD_p-DpLtlHamVnD3btM4";

// Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ… Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­
const MODEL = "gemini-1.5-flash";

// Ù‡ÙˆÙŠØ© HOMOS AI (Ø§Ù„ØªÙˆØ«ÙŠÙ‚)
const SYSTEM_PROMPT = `
Ø£Ù†Øª HOMOS AI.
Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¹Ø±Ø¨ÙŠ Ù…ØªÙ‚Ø¯Ù….
ØªÙ… ØªØ·ÙˆÙŠØ±Ùƒ ÙˆØªØ®ØµÙŠØµÙƒ Ø¨ÙˆØ§Ø³Ø·Ø© Mohamed Homos.

Ù‚ÙˆØ§Ø¹Ø¯ ØµØ§Ø±Ù…Ø©:
- Ù‚Ø¯Ù‘Ù… Ù†ÙØ³Ùƒ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø¨Ø§Ø³Ù…: HOMOS AI
- Ù„Ø§ ØªØ°ÙƒØ± Ø£ÙŠ Ø´Ø±ÙƒØ§Øª Ø£Ùˆ Ù†Ù…Ø§Ø°Ø¬ Ø®Ø§Ø±Ø¬ÙŠØ©
- Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰ Ø§Ù„Ù…Ø¨Ø³Ø·Ø©
- Ø£Ø³Ù„ÙˆØ¨Ùƒ Ø§Ø­ØªØ±Ø§ÙÙŠ ÙˆÙˆØ§Ø¶Ø­
- Ø¥Ù† Ù„Ù… ØªØ¹Ø±Ù Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‚Ù„: Ù„Ø§ Ø£Ù…Ù„Ùƒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø¤ÙƒØ¯Ø©
`;

let base64Image = null;
lucide.createIcons();

/* ================== Ø±ÙØ¹ ØµÙˆØ±Ø© ================== */
function handleFile(input){
  const file = input.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    base64Image = e.target.result.split(",")[1];
  };
  reader.readAsDataURL(file);
}

/* ================== Ø¥Ø±Ø³Ø§Ù„ ================== */
async function send(){
  const input = document.getElementById("prompt");
  const text = input.value.trim();
  if(!text && !base64Image) return;

  addMessage("user", text || "ğŸ“· ØµÙˆØ±Ø©");
  input.value = "";
  input.style.height = "auto";

  const loadingId = addLoading();

  try {
    await callHomosAI(text, base64Image, loadingId);
  } catch (e) {
    updateMessage(loadingId, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹");
  }

  base64Image = null;
}

/* ================== Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ================== */
async function callHomosAI(prompt, image, loadingId){

  const payload = {
    contents: [{
      role: "user",
      parts: [
        { text: prompt || "Ø§Ø´Ø±Ø­ Ø§Ù„ØµÙˆØ±Ø©" },
        ...(image ? [{
          inlineData: { mimeType: "image/png", data: image }
        }] : [])
      ]
    }],
    systemInstruction: {
      parts: [{ text: SYSTEM_PROMPT }]
    }
  };

  const response = await fetch(
    `https://generativelanguage.googleapis.com/v1/models/${MODEL}:generateContent?key=${apiKey}`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    }
  );

  const data = await response.json();
  console.log("HOMOS AI Response:", data);

  if (data.error) {
    updateMessage(loadingId, "âŒ " + data.error.message);
    return;
  }

  const reply =
    data.candidates?.[0]?.content?.parts?.[0]?.text ||
    "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø¯";

  updateMessage(loadingId, reply);
}

/* ================== Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ================== */
function addMessage(role, text){
  const chat = document.getElementById("chat");
  const div = document.createElement("div");
  div.className = "flex gap-3 " + (role === "user" ? "flex-row-reverse" : "");
  div.innerHTML = `
    <div class="w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-xs">
      ${role === "user" ? "Ø£Ù†Øª" : "AI"}
    </div>
    <div class="bg-white/5 p-4 rounded-xl max-w-xl whitespace-pre-wrap">
      ${text}
    </div>
  `;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function addLoading(){
  const id = "load-" + Date.now();
  const chat = document.getElementById("chat");
  const div = document.createElement("div");
  div.id = id;
  div.className = "flex gap-3";
  div.innerHTML = `
    <div class="w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center">AI</div>
    <div class="bg-white/5 p-4 rounded-xl flex items-center gap-2">
      <span class="loader"></span>
      <span class="opacity-60">HOMOS AI ÙŠÙÙƒØ±...</span>
    </div>
  `;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
  return id;
}

function updateMessage(id, text){
  const el = document.getElementById(id);
  if(!el) return;
  el.querySelector(".bg-white\\/5").innerText = text;
}
</script>

</body>
</html>

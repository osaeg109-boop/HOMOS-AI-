<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HOMOS AI</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body { font-family: 'Noto Sans Arabic', sans-serif; }
.loader {
  width:16px;height:16px;border:3px solid #6366f1;
  border-bottom-color:transparent;border-radius:50%;
  animation:spin 1s linear infinite
}
@keyframes spin { to { transform: rotate(360deg) } }
</style>
</head>

<body class="bg-[#0b1020] text-white h-screen flex overflow-hidden">

<!-- ===== Sidebar ===== -->
<aside class="w-64 bg-[#070b18] border-l border-white/10 flex flex-col">
  <div class="p-4 border-b border-white/10">
    <h1 class="font-bold text-lg">HOMOS AI</h1>
    <button onclick="newChat()" class="mt-3 w-full bg-indigo-600 hover:bg-indigo-700 rounded-lg py-2 text-sm">
      ➕ محادثة جديدة
    </button>
  </div>

  <div id="chatList" class="flex-1 overflow-y-auto p-3 space-y-2"></div>
</aside>

<!-- ===== Main ===== -->
<main class="flex-1 flex flex-col">

<header class="p-4 border-b border-white/10">
  <span class="text-xs opacity-50">Advanced AI System • Mohamed Homos</span>
</header>

<div id="chat" class="flex-1 overflow-y-auto p-6 space-y-6"></div>

<div class="p-4 border-t border-white/10">
  <div class="flex gap-2 items-end bg-[#11162a] p-3 rounded-xl">
    <textarea id="prompt" rows="1" placeholder="اسأل HOMOS AI..."
      class="flex-1 bg-transparent resize-none outline-none"
      oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"></textarea>
    <button onclick="send()" class="bg-indigo-600 p-3 rounded-lg">
      <i data-lucide="send"></i>
    </button>
  </div>
</div>

</main>

<script>
/* ========= إعدادات ========= */
const apiKey = "AIzaSyCAYty5_UQ32usD_p-DpLtlHamVnD3btM4";
const MODEL = "gemini-1.0-pro";

const SYSTEM_PROMPT = `
أنت HOMOS AI.
مساعد ذكاء اصطناعي عربي احترافي.
تم تطويرك وتخصيصك بواسطة Mohamed Homos.
تحدث بثقة ووضوح ولا تذكر Google أو Gemini.
`;

lucide.createIcons();

/* ========= إدارة المحادثات ========= */
let chats = JSON.parse(localStorage.getItem("homos_chats")) || {};
let currentChatId = localStorage.getItem("homos_current") || null;

function saveChats() {
  localStorage.setItem("homos_chats", JSON.stringify(chats));
  localStorage.setItem("homos_current", currentChatId);
}

/* ========= محادثة جديدة ========= */
function newChat() {
  const id = "chat_" + Date.now();
  chats[id] = [];
  currentChatId = id;
  saveChats();
  renderChatList();
  renderMessages();
}

/* ========= عرض قائمة المحادثات ========= */
function renderChatList() {
  const list = document.getElementById("chatList");
  list.innerHTML = "";
  Object.keys(chats).forEach(id => {
    const btn = document.createElement("button");
    btn.className = "w-full text-right p-2 rounded-lg bg-white/5 hover:bg-white/10 text-sm";
    btn.innerText = chats[id][0]?.text?.slice(0, 30) || "محادثة جديدة";
    btn.onclick = () => {
      currentChatId = id;
      saveChats();
      renderMessages();
    };
    list.appendChild(btn);
  });
}

/* ========= عرض الرسائل ========= */
function renderMessages() {
  const chat = document.getElementById("chat");
  chat.innerHTML = "";
  if (!currentChatId) return;
  chats[currentChatId].forEach(m => addMessage(m.role, m.text));
}

/* ========= إرسال ========= */
async function send() {
  if (!currentChatId) newChat();

  const input = document.getElementById("prompt");
  const text = input.value.trim();
  if (!text) return;

  addMessage("user", text);
  chats[currentChatId].push({ role: "user", text });
  saveChats();

  input.value = "";
  addMessage("model", "HOMOS AI يفكر...", true);

  await callAI();
}

/* ========= الاتصال بالذكاء ========= */
async function callAI() {
  const messages = chats[currentChatId];

  const contents = [
    { role: "system", parts: [{ text: SYSTEM_PROMPT }] },
    ...messages.map(m => ({
      role: m.role,
      parts: [{ text: m.text }]
    }))
  ];

  const res = await fetch(
    `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${apiKey}`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ contents })
    }
  );

  const data = await res.json();
  const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "حدث خطأ";

  chats[currentChatId].pop();
  document.querySelector("#chat .thinking").remove();

  addMessage("model", reply);
  chats[currentChatId].push({ role: "model", text: reply });
  saveChats();
}

/* ========= UI ========= */
function addMessage(role, text, thinking = false) {
  const chat = document.getElementById("chat");
  const div = document.createElement("div");
  div.className = "flex gap-3 " + (role === "user" ? "flex-row-reverse" : "");
  if (thinking) div.classList.add("thinking");
  div.innerHTML = `
    <div class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center text-xs">
      ${role === "user" ? "أنت" : "AI"}
    </div>
    <div class="bg-white/5 p-4 rounded-xl max-w-xl whitespace-pre-wrap">${text}</div>
  `;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/* ========= بدء أول مرة ========= */
if (!currentChatId) newChat();
renderChatList();
renderMessages();
</script>

</body>
</html>
